include:
  - project: "ci/templates"
    file: "npm/npm-setup-template.yml"
  - project: "ci/templates"
    file: "linting-template.yml"
  - project: "ci/templates"
    file: "docker/build-image-template.yml"
  - project: "ci/templates"
    file: "test/gradle-test-template.yml"
  - project: "ci/templates"
    file: "test/gradle-integration-test-template.yml"
  - project: "ci/templates"
    file: "semantic-release-template.yml"
  - project: "ci/templates"
    file: "badges/badges-template.yml"
  - project: "ci/templates"
    file: "security/trivy-template.yml"

stages:
  - lint
  - build
  - test
  - release
  - badges

# use offline-scan while search.maven.org is down
# remove later
trivy:
    script:
        - echo "Scanning ${IMAGE_FQN}..."
        - >
            trivy --cache-dir $CACHE_DIR i --offline-scan --exit-code 0 --no-progress
            --ignore-unfixed $IMAGE_FQN
        - >
            trivy --cache-dir $CACHE_DIR i --offline-scan --exit-code 1 --no-progress
            --ignore-unfixed --severity CRITICAL $IMAGE_FQN
